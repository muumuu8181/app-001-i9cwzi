<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§  ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1rem;
            color: #666;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .input-section,
        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .text-samples {
            margin-bottom: 20px;
        }

        .sample-item {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            position: relative;
        }

        .sample-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .sample-type {
            font-weight: 600;
            color: #667eea;
            font-size: 0.9rem;
        }

        .sample-length {
            font-size: 0.8rem;
            color: #666;
            background: #e9ecef;
            padding: 2px 8px;
            border-radius: 10px;
        }

        .sample-text {
            line-height: 1.6;
            color: #333;
            font-size: 0.95rem;
        }

        .sample-vector {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: #e3f2fd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.8rem;
            max-height: 100px;
            overflow-y: auto;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .btn-info {
            background: linear-gradient(45deg, #17a2b8, #138496);
            color: white;
        }

        .visualization-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .viz-container {
            width: 100%;
            height: 400px;
            background: #f8f9fa;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            border: 2px solid #e9ecef;
        }

        .similarity-matrix {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .matrix-table th,
        .matrix-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #dee2e6;
            font-size: 0.9rem;
        }

        .matrix-table th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        .similarity-high {
            background: #28a745;
            color: white;
            font-weight: 600;
        }

        .similarity-medium {
            background: #ffc107;
            color: #333;
            font-weight: 600;
        }

        .similarity-low {
            background: #dc3545;
            color: white;
            font-weight: 600;
        }

        .custom-input {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #667eea;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 15px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control textarea {
            resize: vertical;
            min-height: 100px;
        }

        .processing-indicator {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #667eea;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .export-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .vector-display {
            font-family: monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .stats-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>æ–‡ç« ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã¨é¡ä¼¼åº¦åˆ†æã‚·ã‚¹ãƒ†ãƒ </p>
        </div>

        <!-- çµ±è¨ˆæƒ…å ± -->
        <div class="stats-section">
            <div class="stat-card">
                <div class="stat-number" id="totalTexts">5</div>
                <div>ç·ãƒ†ã‚­ã‚¹ãƒˆæ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avgSimilarity">0.65</div>
                <div>å¹³å‡é¡ä¼¼åº¦</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="vectorDimension">128</div>
                <div>ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="processTime">1.2s</div>
                <div>å‡¦ç†æ™‚é–“</div>
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³å‡¦ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="main-content">
            <!-- å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="input-section">
                <h3 class="section-title">ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆã‚µãƒ³ãƒ—ãƒ«</h3>
                
                <div class="text-samples" id="textSamples">
                    <!-- ã‚µãƒ³ãƒ—ãƒ«ãƒ†ã‚­ã‚¹ãƒˆãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>

                <div class="custom-input">
                    <h4>ğŸ”¤ ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ </h4>
                    <textarea class="form-control" id="customText" placeholder="åˆ†æã—ãŸã„ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." rows="4"></textarea>
                    <button class="btn btn-secondary" onclick="addCustomText()">â• ãƒ†ã‚­ã‚¹ãƒˆè¿½åŠ </button>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="processTexts()">ğŸ§  ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Ÿè¡Œ</button>
                    <button class="btn btn-info" onclick="showVectors()">ğŸ“Š ãƒ™ã‚¯ãƒˆãƒ«è¡¨ç¤º</button>
                </div>
            </div>

            <!-- åˆ†æçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="analysis-section">
                <h3 class="section-title">ğŸ“ˆ åˆ†æçµæœ</h3>
                
                <div class="processing-indicator" id="processingIndicator">
                    <div class="spinner"></div>
                    <p>ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°å‡¦ç†ä¸­...</p>
                </div>

                <div id="analysisResults">
                    <p style="text-align: center; color: #666; font-style: italic;">
                        ã€Œãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦åˆ†æã‚’é–‹å§‹ã—ã¦ãã ã•ã„
                    </p>
                </div>
            </div>
        </div>

        <!-- å¯è¦–åŒ–ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="visualization-section">
            <h3 class="section-title">ğŸ“Š ãƒ™ã‚¯ãƒˆãƒ«å¯è¦–åŒ–ã‚°ãƒ©ãƒ•</h3>
            <div class="viz-container" id="vizContainer">
                <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #666;">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ“Š</div>
                        <div>ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¾Œã«ã‚°ãƒ©ãƒ•ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- é¡ä¼¼åº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ -->
        <div class="similarity-matrix">
            <h3 class="section-title">ğŸ” é¡ä¼¼åº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹</h3>
            <div id="matrixContainer">
                <p style="text-align: center; color: #666; font-style: italic;">
                    ãƒ™ã‚¯ãƒˆãƒ«åŒ–å¾Œã«é¡ä¼¼åº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã¾ã™
                </p>
            </div>
        </div>

        <!-- ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="export-section">
            <h4>ğŸ“ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h4>
            <button class="btn btn-secondary" onclick="exportVectors()">ğŸ“„ ãƒ™ã‚¯ãƒˆãƒ«ãƒ‡ãƒ¼ã‚¿ (JSON)</button>
            <button class="btn btn-secondary" onclick="exportSimilarity()">ğŸ“Š é¡ä¼¼åº¦ãƒ‡ãƒ¼ã‚¿ (CSV)</button>
            <button class="btn btn-secondary" onclick="exportAnalysis()">ğŸ“‹ åˆ†æãƒ¬ãƒãƒ¼ãƒˆ (TXT)</button>
        </div>
    </div>

    <script>
        class DeepLearningSystem {
            constructor() {
                this.texts = [];
                this.vectors = [];
                this.similarities = [];
                this.isProcessing = false;
                
                this.initializeSampleTexts();
                this.displaySampleTexts();
                
                console.log('ğŸ§  ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  v1.0 åˆæœŸåŒ–å®Œäº†');
            }

            initializeSampleTexts() {
                this.texts = [
                    {
                        id: 1,
                        type: 'çŸ­æ–‡',
                        text: 'ä»Šæ—¥ã¯è‰¯ã„å¤©æ°—ã§ã™ã€‚',
                        length: 10
                    },
                    {
                        id: 2,
                        type: 'çŸ­æ–‡',
                        text: 'å¤©æ°—ãŒè‰¯ãã¦æ°—æŒã¡ã„ã„ã§ã™ã€‚',
                        length: 14
                    },
                    {
                        id: 3,
                        type: 'ä¸­æ–‡',
                        text: 'æ©Ÿæ¢°å­¦ç¿’ã¯äººå·¥çŸ¥èƒ½ã®ä¸€åˆ†é‡ã§ã‚ã‚Šã€ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãŒãƒ‡ãƒ¼ã‚¿ã‹ã‚‰å­¦ç¿’ã—ã¦ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘ã‚‹æŠ€è¡“ã§ã™ã€‚è¿‘å¹´ã€ã“ã®æŠ€è¡“ã¯æ§˜ã€…ãªåˆ†é‡ã§å¿œç”¨ã•ã‚Œã¦ãŠã‚Šã€ç‰¹ã«ç”»åƒèªè­˜ã‚„è‡ªç„¶è¨€èªå‡¦ç†ã«ãŠã„ã¦å¤§ããªæˆæœã‚’ä¸Šã’ã¦ã„ã¾ã™ã€‚',
                        length: 98
                    },
                    {
                        id: 4,
                        type: 'ä¸­æ–‡',
                        text: 'ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã¯æ©Ÿæ¢°å­¦ç¿’ã®æ‰‹æ³•ã®ä¸€ã¤ã§ã€å¤šå±¤ã®ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ãƒ‡ãƒ¼ã‚¿ã®è¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ç¿’ã—ã¾ã™ã€‚ã“ã®æŠ€è¡“ã«ã‚ˆã‚Šã€å¾“æ¥ã®æ‰‹æ³•ã§ã¯å›°é›£ã ã£ãŸé«˜ç²¾åº¦ãªäºˆæ¸¬ã‚„åˆ†é¡ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚',
                        length: 103
                    },
                    {
                        id: 5,
                        type: 'é•·æ–‡',
                        text: 'äººå·¥çŸ¥èƒ½ï¼ˆAIï¼‰æŠ€è¡“ã®ç™ºå±•ã¯ã€21ä¸–ç´€ã®ç¤¾ä¼šã«é©å‘½çš„ãªå¤‰åŒ–ã‚’ã‚‚ãŸã‚‰ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«æ©Ÿæ¢°å­¦ç¿’ã¨ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã®é€²æ­©ã«ã‚ˆã‚Šã€è‡ªå‹•é‹è»¢è»Šã€åŒ»ç™‚è¨ºæ–­æ”¯æ´ã€é‡‘èå–å¼•ã®è‡ªå‹•åŒ–ã€éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ ãªã©ã€å¤šå²ã«ã‚ãŸã‚‹åˆ†é‡ã§ã®å¿œç”¨ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æŠ€è¡“ã¯å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‡¦ç†ã—ã€äººé–“ã§ã¯ç™ºè¦‹ã§ããªã„ã‚ˆã†ãªè¤‡é›‘ãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã¤ã‘å‡ºã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€åŒæ™‚ã«ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã®å•é¡Œã€é›‡ç”¨ã¸ã®å½±éŸ¿ã€å€«ç†çš„ãªèª²é¡Œãªã©ã‚‚æµ®ä¸Šã—ã¦ãŠã‚Šã€æŠ€è¡“ã®ç™ºå±•ã¨ç¤¾ä¼šçš„è²¬ä»»ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã‚‹ã“ã¨ãŒé‡è¦ãªèª²é¡Œã¨ãªã£ã¦ã„ã¾ã™ã€‚å°†æ¥çš„ã«ã¯ã€AIæŠ€è¡“ãŒã•ã‚‰ã«é€²æ­©ã—ã€äººé–“ã¨AIãŒå”èª¿ã—ã¦åƒãç¤¾ä¼šãŒå®Ÿç¾ã•ã‚Œã‚‹ã“ã¨ãŒæœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚',
                        length: 284
                    }
                ];
            }

            displaySampleTexts() {
                const container = document.getElementById('textSamples');
                container.innerHTML = this.texts.map(text => this.createTextSampleHTML(text)).join('');
            }

            createTextSampleHTML(text) {
                return `
                    <div class="sample-item" data-id="${text.id}">
                        <div class="sample-header">
                            <span class="sample-type">${text.type}</span>
                            <span class="sample-length">${text.length}æ–‡å­—</span>
                        </div>
                        <div class="sample-text">${text.text}</div>
                        <div class="sample-vector" id="vector-${text.id}"></div>
                    </div>
                `;
            }

            addCustomText() {
                const customTextArea = document.getElementById('customText');
                const text = customTextArea.value.trim();
                
                if (!text) {
                    alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const newText = {
                    id: this.texts.length + 1,
                    type: this.getTextType(text.length),
                    text: text,
                    length: text.length
                };

                this.texts.push(newText);
                this.displaySampleTexts();
                customTextArea.value = '';
                
                this.updateStats();
                console.log('ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚­ã‚¹ãƒˆã‚’è¿½åŠ :', newText);
            }

            getTextType(length) {
                if (length <= 20) return 'çŸ­æ–‡';
                if (length <= 100) return 'ä¸­æ–‡';
                return 'é•·æ–‡';
            }

            async processTexts() {
                if (this.isProcessing) return;
                
                this.isProcessing = true;
                this.showProcessing(true);
                
                try {
                    // ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    await this.delay(2000);
                    this.vectors = this.texts.map(text => this.simulateVectorization(text.text));
                    
                    // é¡ä¼¼åº¦è¨ˆç®—
                    await this.delay(1000);
                    this.similarities = this.calculateSimilarities();
                    
                    // çµæœè¡¨ç¤º
                    this.displayAnalysisResults();
                    this.displayVisualization();
                    this.displaySimilarityMatrix();
                    this.updateStats();
                    
                    console.log('ãƒ™ã‚¯ãƒˆãƒ«åŒ–å®Œäº†:', this.vectors.length, 'å€‹ã®ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆ');
                    
                } catch (error) {
                    console.error('å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                    alert('å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
                } finally {
                    this.isProcessing = false;
                    this.showProcessing(false);
                }
            }

            simulateVectorization(text) {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯TF-IDFã‚„Word2Vecã€BERTç­‰ã‚’ä½¿ç”¨
                // ã“ã“ã§ã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã®ç–‘ä¼¼ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç”Ÿæˆ
                const dimension = 128;
                const vector = [];
                
                // ãƒ†ã‚­ã‚¹ãƒˆã®ç‰¹å¾´ã«åŸºã¥ã„ã¦ç–‘ä¼¼ãƒ™ã‚¯ãƒˆãƒ«ã‚’ç”Ÿæˆ
                const seed = this.hashCode(text);
                const rng = this.seededRandom(seed);
                
                for (let i = 0; i < dimension; i++) {
                    vector.push((rng() - 0.5) * 2); // -1ã‹ã‚‰1ã®ç¯„å›²
                }
                
                // æ­£è¦åŒ–
                const magnitude = Math.sqrt(vector.reduce((sum, val) => sum + val * val, 0));
                return vector.map(val => val / magnitude);
            }

            hashCode(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // 32bitæ•´æ•°ã«å¤‰æ›
                }
                return Math.abs(hash);
            }

            seededRandom(seed) {
                let m = 0x80000000; // 2**31
                let a = 1103515245;
                let c = 12345;
                let state = seed;
                
                return function() {
                    state = (a * state + c) % m;
                    return state / (m - 1);
                };
            }

            calculateSimilarities() {
                const similarities = [];
                
                for (let i = 0; i < this.vectors.length; i++) {
                    const row = [];
                    for (let j = 0; j < this.vectors.length; j++) {
                        if (i === j) {
                            row.push(1.0);
                        } else {
                            const similarity = this.cosineSimilarity(this.vectors[i], this.vectors[j]);
                            row.push(similarity);
                        }
                    }
                    similarities.push(row);
                }
                
                return similarities;
            }

            cosineSimilarity(vecA, vecB) {
                const dotProduct = vecA.reduce((sum, a, i) => sum + a * vecB[i], 0);
                const magnitudeA = Math.sqrt(vecA.reduce((sum, a) => sum + a * a, 0));
                const magnitudeB = Math.sqrt(vecB.reduce((sum, b) => sum + b * b, 0));
                
                return dotProduct / (magnitudeA * magnitudeB);
            }

            displayAnalysisResults() {
                const container = document.getElementById('analysisResults');
                
                // æœ€ã‚‚é¡ä¼¼åº¦ã®é«˜ã„ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã‚‹
                let maxSimilarity = 0;
                let maxPair = null;
                
                for (let i = 0; i < this.similarities.length; i++) {
                    for (let j = i + 1; j < this.similarities[i].length; j++) {
                        if (this.similarities[i][j] > maxSimilarity) {
                            maxSimilarity = this.similarities[i][j];
                            maxPair = [i, j];
                        }
                    }
                }
                
                // æœ€ã‚‚é¡ä¼¼åº¦ã®ä½ã„ãƒšã‚¢ã‚’è¦‹ã¤ã‘ã‚‹
                let minSimilarity = 1;
                let minPair = null;
                
                for (let i = 0; i < this.similarities.length; i++) {
                    for (let j = i + 1; j < this.similarities[i].length; j++) {
                        if (this.similarities[i][j] < minSimilarity) {
                            minSimilarity = this.similarities[i][j];
                            minPair = [i, j];
                        }
                    }
                }

                container.innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #28a745; margin-bottom: 10px;">âœ… å‡¦ç†å®Œäº†</h4>
                        <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <strong>${this.texts.length}å€‹ã®ãƒ†ã‚­ã‚¹ãƒˆ</strong>ã‚’ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã—ã¾ã—ãŸ
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ” é¡ä¼¼åº¦åˆ†æçµæœ</h4>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            <strong>æœ€é«˜é¡ä¼¼åº¦:</strong> ${(maxSimilarity * 100).toFixed(1)}%<br>
                            <small>ãƒ†ã‚­ã‚¹ãƒˆ${maxPair[0] + 1} ã¨ ãƒ†ã‚­ã‚¹ãƒˆ${maxPair[1] + 1}</small>
                        </div>
                        
                        <div style="background: #ffecb3; padding: 15px; border-radius: 8px;">
                            <strong>æœ€ä½é¡ä¼¼åº¦:</strong> ${(minSimilarity * 100).toFixed(1)}%<br>
                            <small>ãƒ†ã‚­ã‚¹ãƒˆ${minPair[0] + 1} ã¨ ãƒ†ã‚­ã‚¹ãƒˆ${minPair[1] + 1}</small>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: #667eea; margin-bottom: 10px;">ğŸ’¡ åˆ†æã‚¤ãƒ³ã‚µã‚¤ãƒˆ</h4>
                        <ul style="margin-left: 20px; line-height: 1.6;">
                            <li>çŸ­æ–‡åŒå£«ã¯æ¯”è¼ƒçš„é«˜ã„é¡ä¼¼åº¦ã‚’ç¤ºã—ã¦ã„ã¾ã™</li>
                            <li>æŠ€è¡“ç³»ã®ä¸­æ–‡ãƒ»é•·æ–‡ã¯å°‚é–€ç”¨èªã«ã‚ˆã‚Šé«˜ã„ç›¸é–¢ãŒã‚ã‚Šã¾ã™</li>
                            <li>æ–‡ç« ã®é•·ã•ã¨é¡ä¼¼åº¦ã«ä¸€å®šã®ç›¸é–¢ãŒè¦‹ã‚‰ã‚Œã¾ã™</li>
                        </ul>
                    </div>
                `;
            }

            displayVisualization() {
                const container = document.getElementById('vizContainer');
                
                // 2æ¬¡å…ƒPCAã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã«ã¯t-SNEã‚„UMAPã‚’ä½¿ç”¨ï¼‰
                const points = this.texts.map((text, i) => {
                    const angle = (i / this.texts.length) * 2 * Math.PI;
                    const radius = 100 + Math.random() * 80;
                    return {
                        x: 200 + Math.cos(angle) * radius,
                        y: 200 + Math.sin(angle) * radius,
                        text: text,
                        color: this.getColorByType(text.type)
                    };
                });

                const svg = `
                    <svg width="100%" height="100%" viewBox="0 0 400 400">
                        <defs>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge> 
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/> 
                                </feMerge>
                            </filter>
                        </defs>
                        ${points.map((point, i) => `
                            <circle cx="${point.x}" cy="${point.y}" r="12" 
                                    fill="${point.color}" stroke="white" stroke-width="2"
                                    filter="url(#glow)" opacity="0.9">
                                <title>ãƒ†ã‚­ã‚¹ãƒˆ${i + 1}: ${point.text.type}</title>
                            </circle>
                            <text x="${point.x}" y="${point.y - 20}" text-anchor="middle"
                                  font-size="10" font-weight="bold" fill="#333">
                                ${i + 1}
                            </text>
                        `).join('')}
                    </svg>
                `;

                container.innerHTML = svg;
            }

            getColorByType(type) {
                const colors = {
                    'çŸ­æ–‡': '#ff6b6b',
                    'ä¸­æ–‡': '#4ecdc4',
                    'é•·æ–‡': '#45b7d1'
                };
                return colors[type] || '#667eea';
            }

            displaySimilarityMatrix() {
                const container = document.getElementById('matrixContainer');
                
                let tableHTML = `
                    <table class="matrix-table">
                        <thead>
                            <tr>
                                <th>ãƒ†ã‚­ã‚¹ãƒˆ</th>
                                ${this.texts.map((_, i) => `<th>T${i + 1}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                for (let i = 0; i < this.similarities.length; i++) {
                    tableHTML += `<tr><th>T${i + 1}</th>`;
                    for (let j = 0; j < this.similarities[i].length; j++) {
                        const similarity = this.similarities[i][j];
                        const percentage = (similarity * 100).toFixed(0);
                        const className = this.getSimilarityClass(similarity);
                        
                        tableHTML += `<td class="${className}">${percentage}%</td>`;
                    }
                    tableHTML += '</tr>';
                }
                
                tableHTML += '</tbody></table>';
                container.innerHTML = tableHTML;
            }

            getSimilarityClass(similarity) {
                if (similarity >= 0.7) return 'similarity-high';
                if (similarity >= 0.3) return 'similarity-medium';
                return 'similarity-low';
            }

            showVectors() {
                if (this.vectors.length === 0) {
                    alert('ã¾ãšãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                this.texts.forEach((text, i) => {
                    const vectorDisplay = document.getElementById(`vector-${text.id}`);
                    if (vectorDisplay) {
                        const vectorStr = this.vectors[i].slice(0, 10).map(v => v.toFixed(4)).join(', ') + '...';
                        vectorDisplay.innerHTML = `<strong>ãƒ™ã‚¯ãƒˆãƒ« (æœ€åˆã®10æ¬¡å…ƒ):</strong><br>[${vectorStr}]`;
                        vectorDisplay.style.display = 'block';
                    }
                });
            }

            showProcessing(show) {
                const indicator = document.getElementById('processingIndicator');
                const results = document.getElementById('analysisResults');
                
                if (show) {
                    indicator.style.display = 'block';
                    results.style.display = 'none';
                } else {
                    indicator.style.display = 'none';
                    results.style.display = 'block';
                }
            }

            updateStats() {
                document.getElementById('totalTexts').textContent = this.texts.length;
                
                if (this.similarities.length > 0) {
                    let totalSimilarity = 0;
                    let count = 0;
                    
                    for (let i = 0; i < this.similarities.length; i++) {
                        for (let j = i + 1; j < this.similarities[i].length; j++) {
                            totalSimilarity += this.similarities[i][j];
                            count++;
                        }
                    }
                    
                    const avgSimilarity = count > 0 ? totalSimilarity / count : 0;
                    document.getElementById('avgSimilarity').textContent = avgSimilarity.toFixed(2);
                }
            }

            exportVectors() {
                if (this.vectors.length === 0) {
                    alert('ã¾ãšãƒ™ã‚¯ãƒˆãƒ«åŒ–ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const data = {
                    timestamp: new Date().toISOString(),
                    texts: this.texts,
                    vectors: this.vectors,
                    dimension: this.vectors[0].length
                };

                this.downloadFile(JSON.stringify(data, null, 2), 'vectors.json', 'application/json');
            }

            exportSimilarity() {
                if (this.similarities.length === 0) {
                    alert('ã¾ãšé¡ä¼¼åº¦è¨ˆç®—ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const headers = ['ãƒ†ã‚­ã‚¹ãƒˆID', ...this.texts.map((_, i) => `T${i + 1}`)];
                const rows = this.similarities.map((row, i) => [
                    `T${i + 1}`,
                    ...row.map(sim => (sim * 100).toFixed(1) + '%')
                ]);

                const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
                this.downloadFile('\uFEFF' + csv, 'similarity-matrix.csv', 'text/csv');
            }

            exportAnalysis() {
                if (this.similarities.length === 0) {
                    alert('ã¾ãšåˆ†æã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');
                    return;
                }

                const report = `
ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
========================================

ç”Ÿæˆæ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}

## åŸºæœ¬çµ±è¨ˆ
- ç·ãƒ†ã‚­ã‚¹ãƒˆæ•°: ${this.texts.length}
- ãƒ™ã‚¯ãƒˆãƒ«æ¬¡å…ƒ: ${this.vectors[0].length}
- å¹³å‡é¡ä¼¼åº¦: ${document.getElementById('avgSimilarity').textContent}

## ãƒ†ã‚­ã‚¹ãƒˆä¸€è¦§
${this.texts.map((text, i) => `
${i + 1}. [${text.type}] ${text.text.substring(0, 50)}${text.text.length > 50 ? '...' : ''}
   æ–‡å­—æ•°: ${text.length}
`).join('')}

## é¡ä¼¼åº¦åˆ†æçµæœ
${this.similarities.map((row, i) => 
    row.map((sim, j) => j > i ? `T${i + 1} â†” T${j + 1}: ${(sim * 100).toFixed(1)}%` : '').filter(x => x).join('\n')
).filter(x => x).join('\n')}

ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ : ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  v1.0
                `;

                this.downloadFile(report.trim(), 'analysis-report.txt', 'text/plain');
            }

            downloadFile(content, filename, mimeType) {
                const blob = new Blob([content], { type: mimeType });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°å®šç¾©
        let deepLearningSystem;

        function addCustomText() {
            deepLearningSystem.addCustomText();
        }

        function processTexts() {
            deepLearningSystem.processTexts();
        }

        function showVectors() {
            deepLearningSystem.showVectors();
        }

        function exportVectors() {
            deepLearningSystem.exportVectors();
        }

        function exportSimilarity() {
            deepLearningSystem.exportSimilarity();
        }

        function exportAnalysis() {
            deepLearningSystem.exportAnalysis();
        }

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            deepLearningSystem = new DeepLearningSystem();
        });

        // ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
        console.log('ğŸ§  ãƒ‡ã‚£ãƒ¼ãƒ—ãƒ©ãƒ¼ãƒ‹ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  v1.0');
        console.log('ä½œæˆæ—¥: 2025-07-26');
        console.log('æ©Ÿèƒ½: æ–‡ç« ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã€é¡ä¼¼åº¦åˆ†æã€å¯è¦–åŒ–ã€ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ');
        console.log('æŠ€è¡“: ç–‘ä¼¼ãƒ™ã‚¯ãƒˆãƒ«åŒ–ã€ã‚³ã‚µã‚¤ãƒ³é¡ä¼¼åº¦ã€SVGå¯è¦–åŒ–');
    </script>
</body>
</html>